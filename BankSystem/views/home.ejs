<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="stylesheet" href="home.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>
  <body>
    <header class="menu">
        <div class="menu-logo">
            <img src="image/logo_icon.png" alt="Website Logo">
        </div>
        <nav>
            <ul class="horizontal-menu">
                <li><a href="/home">
                  <i class="fa-solid fa-wallet" style="color: #ffffff;"></i>
                  &nbsp
                    T√†i Kho·∫£n
                </a></li>
                <li><a href="/saving">
                  <i class="fa-solid fa-piggy-bank" style="color: #ffffff;"></i>
                  &nbsp
                    S·ªï Ti·∫øt Ki·ªám
                </a></li>
                <li><a href="/card">
                  <i class="fa-solid fa-credit-card" style="color: #ffffff;"></i>
                    &nbsp
                    Th·∫ª Ng√¢n H√†ng  
                </a></li>
                <li><a href="/vay">
                  <i class="fa-solid fa-money-bill" style="color: #ffffff;"></i>
                  &nbsp
                    Vay
                </a></li>
                <li><a href="/thongbao">
                  <i class="fa-solid fa-clock-rotate-left" style="color: #ffffff;"></i>
                  &nbsp
                    L·ªãch S·ª≠ Giao D·ªãch
                </a></li>
                <li><a href="#">
                  <i class="fa-solid fa-gear" style="color: #ffffff;"></i>
                </a></li>
 
            </ul>
          </nav>
        <div class="user-avatar">
          <i class="fa-solid fa-user-tie" style="color: #ffffff;"></i>
            <div class="dropdown">
                <a href="/profile">Profile</a>
                <a href="/">Logout</a>
            </div>
        </div>
    </header>
    <div class="dashboard">
      <!-- Promo Section -->
      <div class="section promo">
        <div class="section-header">
          <img src="image/iconwall.png" alt="Wallet">
          <div class="wallet-info">
            <div class="name"><%= data.name %></div>
            
            <div class="wallet-number" style="margin-top: 10px;">S·ªë t√†i kho·∫£n: <%= data.accountNumber %></div>
          </div>
        
        
        </div>
        <div class="section-balance">
          <div class="label">S·ªê D∆Ø HI·ªÜN C√ì</div>
          <div class="amount-container">
            <div id="amount" class="amount">
              <% if (data && data.amount !== undefined) { %>
                <%= data.amount.toLocaleString() %>ƒë
              <% } else { %>
                0ƒë <!-- Hi·ªÉn th·ªã s·ªë 0 n·∫øu amount kh√¥ng t·ªìn t·∫°i -->
              <% } %>
            </div>

            <button id="toggle-visibility" class="eye-icon">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>
        
        
        </div>
        <div class="section-actions">
          <div>
            <i class="fa-solid fa-hand-holding-dollar"></i>
            <a href="/naptien">N·∫°p ti·ªÅn/R√∫t ti·ªÅn</a>
          </div>
          <div>
            <i class="fa-solid fa-right-to-bracket"></i>
            <a href="/chuyentien">Chuy·ªÉn ti·ªÅn</a>
          </div>
        </div>
      </div>
      <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
      <div>
        <h2 class="hover-effect" onclick="window.location.href='/saving'">S·ªï Ti·∫øt Ki·ªám</h2>
        <div class="section image-section1" onclick="window.location.href='/saving'"></div>
    </div>
  <!-- C√°ch 2 √¥ -->
  <div></div><div></div><div></div><div></div><div></div>
  
      <div>
        <h2 class="hover-effect" onclick="window.location.href='/card'">Th·∫ª Ng√¢n H√†ng</i></h2>
        <div class="section image-section2" onclick="window.location.href='/card'"></div>
    </div>
  </div>
  <div class="dashboard">
    <div>
      <h2 class="hover-effect" onclick="window.location.href='/vaytragop'">Vay Tr·∫£ G√≥p</i></h2>
      <div class="section image-section3" onclick="window.location.href='/vaytragop'"></div>
  </div>
<!-- C√°ch 2 √¥ -->
<div></div><div></div><div></div><div></div><div></div>

    <div>
      <h2 class="hover-effect" onclick="window.location.href='/vaythechap'">Vay Th·∫ø Ch·∫•p</i></h2>
      <div class="section image-section4" onclick="window.location.href='/vaythechap'"></div>
  </div>
  <div></div><div></div><div></div><div></div><div></div>

  <div>
    <h2 class="hover-effect" onclick="window.location.href='/shopping'">Mua S·∫Øm</i></h2>
    <div class="section image-section5" onclick="window.location.href='/shopping'"></div>
</div>

  <div id="chat-widget">
    <div id="chat-bubble">üí¨</div>
    <div id="chat-container">
      <h3>H·ªó tr·ª£ kh√°ch h√†ng</h3>
      <div id="messages"></div>
      <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
        <button id="send-button">G·ª≠i</button>
      </div>
    </div>
  </div>
</div>

<div style="margin-bottom: 100px;"></div>

</body>
<script>
  const userAvatar = document.querySelector('.user-avatar');
  const dropdown = document.querySelector('.dropdown');
  const sender = "<%= data.name %>"; // T√™n user
  const receiver = "admin"; // M·∫∑c ƒë·ªãnh admin nh·∫≠n
  userAvatar.addEventListener('mouseenter', () => {
      dropdown.style.display = 'block';
  });

  userAvatar.addEventListener('mouseleave', () => {
      setTimeout(() => {
          dropdown.style.display = 'none';
      }, 5000); 
  });

  dropdown.addEventListener('mouseenter', () => {
      dropdown.style.display = 'block';
  });

  dropdown.addEventListener('mouseleave', () => {
      dropdown.style.display = 'none';
  });
  document.getElementById("toggle-visibility").addEventListener("click", function () {
    const amountElement = document.getElementById("amount");
    const eyeIcon = this.querySelector("i");
    const isHidden = amountElement.textContent.includes("*");
  
    if (isHidden) {
      amountElement.textContent = "<%= data.amount.toLocaleString() %>ƒë";
      eyeIcon.classList.remove("fa-eye-slash");
      eyeIcon.classList.add("fa-eye");
    } else {
      amountElement.textContent = "**********"; 
      eyeIcon.classList.remove("fa-eye");
      eyeIcon.classList.add("fa-eye-slash");
    }
  });
  document.getElementById('chat-bubble').addEventListener('click', function () {
    const chatContainer = document.getElementById('chat-container');
    chatContainer.style.display = chatContainer.style.display === 'none' ? 'block' : 'none';
  });
  
document.getElementById("send-button").addEventListener("click", async () => {
  const messageInput = document.getElementById("chat-input");
  const message = messageInput.value.trim();

  if (!message) return alert("Vui l√≤ng nh·∫≠p tin nh·∫Øn!");

  try {
      // G·ª≠i tin nh·∫Øn t·ªõi server
      await fetch("/send-message", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sender, receiver, message }),
      });

      // Th√™m tin nh·∫Øn c·ªßa admin v√†o khung chat ngay l·∫≠p t·ª©c
      const messagesDiv = document.getElementById("messages");
      const div = document.createElement("div");
      div.textContent = `admin: ${message}`;
      div.style.color = "blue"; // ƒê·∫∑t m√†u s·∫Øc ƒë·∫∑c bi·ªát cho admin (tu·ª≥ ch·ªçn)
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight; // Cu·ªôn xu·ªëng cu·ªëi khung chat

      // X√≥a n·ªôi dung √¥ nh·∫≠p
      messageInput.value = "";

  } catch (error) {
      console.error("L·ªói g·ª≠i tin nh·∫Øn:", error);
  }
});
const fetchMessages = async () => {
  try {
      const response = await fetch(`/get-messages?sender=${sender}&receiver=${receiver}`);
      const data = await response.json();
      const messagesDiv = document.getElementById("messages");
      messagesDiv.innerHTML = ""; // X√≥a n·ªôi dung c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã m·ªõi

      if (data.success) {
          data.messages.forEach(msg => {
              const div = document.createElement("div");
              div.textContent = `${msg.sender}: ${msg.message}`;
              if (msg.sender === "admin") {
                  div.style.color = "blue"; // M√†u xanh cho tin nh·∫Øn admin
              }
              messagesDiv.appendChild(div);
          });

          // T·ª± ƒë·ªông cu·ªôn xu·ªëng cu·ªëi khung chat
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
  } catch (error) {
      console.error("L·ªói t·∫£i tin nh·∫Øn:", error);
  }
};

// C·∫≠p nh·∫≠t tin nh·∫Øn theo chu k·ª≥
setInterval(fetchMessages, 200);
fetchMessages();

</script>


</html>